<!DOCTYPE html>

<html lang="pt">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Gerador de Desenhos para Colorir</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">

<style>

body { font-family: 'Baloo 2', cursive; background-color: #f0f9ff; }

.loader { border: 4px solid #fde68a; border-top: 4px solid #38bdf8; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.image-container img { max-height: 400px; width: auto; max-width: 100%; border-radius: 1rem; object-fit: contain; cursor: crosshair; }

.color-palette { display: flex; gap: 5px; margin-top: 10px; }

.color-swatch { width: 30px; height: 30px; border-radius: 0.25rem; cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 2px rgba(0,0,0,0.5); }

</style>

</head>

<body class="flex items-center justify-center min-h-screen p-4">



<main class="main-container bg-white p-6 sm:p-8 rounded-2xl shadow-2xl max-w-4xl w-full">



Â  <div id="auth-section">

Â  Â  <div class="text-center">

Â  Â  Â  <h1 class="text-3xl sm:text-4xl font-bold text-sky-500">Bem-vindo! âœ¨</h1>

Â  Â  Â  <p class="text-gray-600 mt-2">Crie a sua conta ou faÃ§a login para comeÃ§ar.</p>

Â  Â  Â  <div id="auth-form-container" class="mt-6 max-w-sm mx-auto">

Â  Â  Â  Â  <form id="login-form">

Â  Â  Â  Â  Â  <input type="email" id="login-email" placeholder="O seu email" required class="shadow-sm border-2 rounded-full w-full py-3 px-6 text-center mb-4 focus:ring-2 focus:ring-sky-400 outline-none">

Â  Â  Â  Â  Â  <input type="password" id="login-password" placeholder="A sua palavra-passe" required class="shadow-sm border-2 rounded-full w-full py-3 px-6 text-center mb-6 focus:ring-2 focus:ring-sky-400 outline-none">

Â  Â  Â  Â  Â  <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-full font-bold text-lg transition-transform transform hover:scale-105">Entrar</button>

Â  Â  Â  Â  </form>

Â  Â  Â  Â  <form id="register-form" class="hidden">

Â  Â  Â  Â  Â  <input type="email" id="register-email" placeholder="O seu email" required class="shadow-sm border-2 rounded-full w-full py-3 px-6 text-center mb-4 focus:ring-2 focus:ring-sky-400 outline-none">

Â  Â  Â  Â  Â  <input type="password" id="register-password" placeholder="Crie uma palavra-passe" required class="shadow-sm border-2 rounded-full w-full py-3 px-6 text-center mb-6 focus:ring-2 focus:ring-sky-400 outline-none">

Â  Â  Â  Â  Â  <button type="submit" class="w-full bg-sky-500 hover:bg-sky-600 text-white py-3 rounded-full font-bold text-lg transition-transform transform hover:scale-105">Criar Conta</button>

Â  Â  Â  Â  </form>

Â  Â  Â  </div>

Â  Â  Â  <p class="text-sm text-gray-500 mt-4">

Â  Â  Â  Â  <a href="#" id="auth-toggle-link" class="text-sky-600 hover:underline">NÃ£o tem uma conta? Registe-se aqui.</a>

Â  Â  Â  </p>

Â  Â  Â  <p id="auth-error" class="text-red-500 mt-4 font-semibold h-5"></p>

Â  Â  </div>

Â  </div>



Â  <div id="app-content" class="hidden">

Â  Â  <div class="text-center mb-8 relative">

Â  Â  Â  <div class="absolute top-0 right-0 -mt-4 -mr-4 sm:-mt-6 sm:-mr-6">

Â  Â  Â  Â  <span id="credits-display" class="font-bold text-lg text-green-600 bg-white px-3 py-1 rounded-full shadow-md"></span>

Â  Â  Â  Â  <button id="logout-button" class="ml-2 text-gray-400 hover:text-red-500 font-bold" title="Sair">Sair</button>

Â  Â  Â  </div>

Â  Â  Â  <h1 class="text-3xl sm:text-4xl font-bold text-sky-600">Desenhos para Colorir! ðŸŽ¨</h1>

Â  Â  Â  <p class="text-gray-600 mt-2 text-lg">Transforme qualquer foto numa pÃ¡gina para colorir!</p>

Â  Â  </div>



Â  Â  <div class="flex justify-center mb-6">

Â  Â  Â  <label for="image-upload" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 py-3 px-8 rounded-full cursor-pointer font-bold text-lg">Anexar Foto</label>

Â  Â  Â  <input type="file" id="image-upload" accept="image/*" class="hidden">

Â  Â  </div>



Â  Â  <div id="results" class="grid grid-cols-1 md:grid-cols-2 gap-8 hidden">

Â  Â  Â  <div class="text-center">

Â  Â  Â  Â  <h2 class="text-2xl font-semibold mb-3">A Sua Foto Original</h2>

Â  Â  Â  Â  <div id="original-image-container" class="image-container bg-sky-100 min-h-[250px] flex items-center justify-center rounded-2xl p-2 shadow-inner"></div>

Â  Â  Â  </div>

Â  Â  Â  <div class="text-center">

Â  Â  Â  Â  <h2 class="text-2xl font-semibold mb-3">O Seu Desenho</h2>

Â  Â  Â  Â  <div id="generated-image-container" class="image-container bg-sky-100 min-h-[250px] flex items-center justify-center rounded-2xl p-2 shadow-inner">

Â  Â  Â  Â  Â  <p class="text-gray-500">Aguardando a sua foto...</p>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button id="color-button" class="bg-pink-500 hover:bg-pink-600 text-white py-2 px-6 rounded-full mt-4 hidden">Colorir</button>

Â  Â  Â  Â  <div id="color-palette" class="color-palette hidden">

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#f87171;" data-color="#f87171"></div>

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#34d399;" data-color="#34d399"></div>

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#60a5fa;" data-color="#60a5fa"></div>

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#facc15;" data-color="#facc15"></div>

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#a78bfa;" data-color="#a78bfa"></div>

Â  Â  Â  Â  Â  <div class="color-swatch" style="background-color:#f472b6;" data-color="#f472b6"></div>

Â  Â  Â  Â  </div>

Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div class="flex justify-center mt-8">

Â  Â  Â  <button id="generate-button" class="bg-sky-600 hover:bg-sky-700 text-white py-3 px-8 rounded-full font-bold text-lg hidden">Transformar em Desenho</button>

Â  Â  </div>



Â  Â  <div id="error-message" class="text-center text-red-500 mt-4 font-semibold h-5"></div>

Â  </div>

</main>



<script>

const CLOUDFLARE_WORKER_URL = 'https://fotoparapintar.lucasabreucotefis.workers.dev';



// --- LOGIN / REGISTO / LOGOUT ---

const authSection = document.getElementById('auth-section');

const appContent = document.getElementById('app-content');

const loginForm = document.getElementById('login-form');

const registerForm = document.getElementById('register-form');

const authToggleLink = document.getElementById('auth-toggle-link');

const authError = document.getElementById('auth-error');

const logoutButton = document.getElementById('logout-button');

const creditsDisplay = document.getElementById('credits-display');

const imageUpload = document.getElementById('image-upload');

const resultsSection = document.getElementById('results');

const originalImageContainer = document.getElementById('original-image-container');

const generatedImageContainer = document.getElementById('generated-image-container');

const errorMessageDiv = document.getElementById('error-message');

const generateButton = document.getElementById('generate-button');



let currentUser = null;

let lastBase64Image = null;



window.addEventListener('load', () => {

Â  currentUser = JSON.parse(localStorage.getItem('currentUser'));

Â  if(currentUser) showApp(); else showAuth();

});



authToggleLink.addEventListener('click', (e)=>{

Â  e.preventDefault();

Â  const isLoginVisible = !loginForm.classList.contains('hidden');

Â  loginForm.classList.toggle('hidden',isLoginVisible);

Â  registerForm.classList.toggle('hidden',!isLoginVisible);

Â  authToggleLink.textContent = isLoginVisible?'JÃ¡ tem uma conta? Entre aqui.':'NÃ£o tem uma conta? Registe-se aqui.';

Â  authError.textContent='';

});



registerForm.addEventListener('submit', e=>{ e.preventDefault(); handleAuth('register','register-email','register-password'); });

loginForm.addEventListener('submit', e=>{ e.preventDefault(); handleAuth('login','login-email','login-password'); });



async function handleAuth(endpoint,emailId,passwordId){

Â  authError.textContent='';

Â  const email=document.getElementById(emailId).value.trim();

Â  const password=document.getElementById(passwordId).value;

Â  try{

Â  Â  const res=await fetch(`${CLOUDFLARE_WORKER_URL}/${endpoint}`,{

Â  Â  Â  method:'POST',

Â  Â  Â  headers:{'Content-Type':'application/json'},

Â  Â  Â  body:JSON.stringify({email,password})

Â  Â  });

Â  Â  const data=await res.json();

Â  Â  if(!res.ok) throw new Error(data.error||`Erro no ${endpoint}`);

Â  Â  if(endpoint==='register'){ alert('Conta criada com sucesso! FaÃ§a login.'); authToggleLink.click(); return; }

Â  Â  currentUser={email,credits:data.credits};

Â  Â  localStorage.setItem('currentUser',JSON.stringify(currentUser));

Â  Â  showApp();

Â  }catch(err){ authError.textContent=err.message; }

}



logoutButton.addEventListener('click', ()=>{

Â  currentUser=null; localStorage.removeItem('currentUser'); showAuth();

Â  resultsSection.classList.add('hidden'); originalImageContainer.innerHTML=''; generatedImageContainer.innerHTML='<p class="text-gray-500">Aguardando a sua foto...</p>'; generateButton.classList.add('hidden'); imageUpload.value='';

});



// --- UPLOAD / REDIMENSIONAR ---

imageUpload.addEventListener('change', async ev=>{

Â  const file=ev.target.files[0]; if(!file) return;

Â  const previewUrl=await fileToBase64(file);

Â  originalImageContainer.innerHTML=`<img src="${previewUrl}" alt="Foto Original">`;

Â  resultsSection.classList.remove('hidden'); generateButton.classList.remove('hidden');

Â  generatedImageContainer.innerHTML='<p class="text-gray-500">Pronto para transformar!</p>';

Â  const resized=await resizeImageFile(file,1024); lastBase64Image=resized;

});



generateButton.addEventListener('click', async ()=>{

Â  errorMessageDiv.textContent='';

Â  if(!currentUser){ errorMessageDiv.textContent='FaÃ§a login.'; return; }

Â  if(!lastBase64Image){ errorMessageDiv.textContent='Anexe uma foto.'; return; }

Â  const { dataUrl,mimeType }=lastBase64Image;

Â  const base64data=dataUrl.split(',')[1];

Â  const payload={imageData:base64data,mimeType,userEmail:currentUser.email};

Â  generatedImageContainer.innerHTML='<div class="loader"></div>'; generateButton.disabled=true;

Â  try{

Â  Â  const resp=await fetch(`${CLOUDFLARE_WORKER_URL}/generate-image`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});

Â  Â  const data=await resp.json();

Â  Â  if(!resp.ok) throw new Error(data.error||'Erro ao gerar a imagem');

Â  Â  // Mostrar imagem gerada

Â  Â  enableColoring(data.imageBase64);

Â  Â  currentUser.credits=data.credits;

Â  Â  localStorage.setItem('currentUser',JSON.stringify(currentUser));

Â  Â  updateCreditsDisplay();

Â  }catch(err){ generatedImageContainer.innerHTML=`<p class="text-red-600 font-bold">${err.message}</p>`; }

Â  finally{ generateButton.disabled=false; }

});



// --- FUNÃ‡Ã•ES ---

function showApp(){ authSection.classList.add('hidden'); appContent.classList.remove('hidden'); updateCreditsDisplay(); }

function showAuth(){ appContent.classList.add('hidden'); authSection.classList.remove('hidden'); }

function updateCreditsDisplay(){ creditsDisplay.textContent=currentUser?`CrÃ©ditos: ${currentUser.credits}`:''; }

function fileToBase64(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>resolve(reader.result);reader.onerror=reject;reader.readAsDataURL(file);});}

async function resizeImageFile(file,maxDimension=1024){const dataUrl=await fileToBase64(file);return new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>{let {width,height}=img;if(width>maxDimension||height>maxDimension){if(width>height){height=Math.round((height*maxDimension)/width);width=maxDimension;}else{width=Math.round((width*maxDimension)/height);height=maxDimension;}}const canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,width,height);const mimeType=file.type==='image/png'?'image/png':'image/jpeg';resolve({dataUrl:canvas.toDataURL(mimeType,0.92),mimeType});};img.onerror=reject;img.src=dataUrl;});}



// --- COLORIR ---

const colorButton = document.getElementById('color-button');

const colorPalette = document.getElementById('color-palette');

let selectedColor=null;

let coloringCanvas=null;

let ctx=null;



function enableColoring(base64Img){

Â  colorButton.classList.remove('hidden');

Â  colorButton.onclick=()=>{colorPalette.classList.toggle('hidden');};

Â  document.querySelectorAll('.color-swatch').forEach(swatch=>{swatch.onclick=()=>{selectedColor=swatch.dataset.color;colorPalette.classList.add('hidden');};});

Â  const img=new Image();

Â  img.onload=()=>{

Â  Â  coloringCanvas=document.createElement('canvas');

Â  Â  coloringCanvas.width=img.width;

Â  Â  coloringCanvas.height=img.height;

Â  Â  ctx=coloringCanvas.getContext('2d');

Â  Â  ctx.drawImage(img,0,0);

Â  Â  generatedImageContainer.innerHTML=''; generatedImageContainer.appendChild(coloringCanvas);

Â  Â  coloringCanvas.addEventListener('click', e=>{

Â  Â  Â  if(!selectedColor) return;

Â  Â  Â  const rect=coloringCanvas.getBoundingClientRect();

Â  Â  Â  const x=Math.floor((e.clientX-rect.left)*(coloringCanvas.width/rect.width));

Â  Â  Â  const y=Math.floor((e.clientY-rect.top)*(coloringCanvas.height/rect.height));

Â  Â  Â  floodFill(x,y,selectedColor);

Â  Â  });

Â  };

Â  img.src=`data:image/png;base64,${base64Img}`;

}



function floodFill(startX,startY,fillColor){

Â  const imgData=ctx.getImageData(0,0,coloringCanvas.width,coloringCanvas.height);

Â  const data=imgData.data;

Â  const width=coloringCanvas.width;

Â  const height=coloringCanvas.height;

Â  const pixelStack=[[startX,startY]];

Â  const color=hexToRgba(fillColor);

Â  const targetIdx=(startY*width+startX)*4;

Â  const targetColor=[data[targetIdx],data[targetIdx+1],data[targetIdx+2],data[targetIdx+3]];

Â  if(colorsMatch(targetColor,color)) return;

Â  while(pixelStack.length){

Â  Â  const [x,y]=pixelStack.pop();

Â  Â  const idx=(y*width+x)*4;

Â  Â  if(!colorsMatch([data[idx],data[idx+1],data[idx+2],data[idx+3]],targetColor)) continue;

Â  Â  data[idx]=color[0]; data[idx+1]=color[1]; data[idx+2]=color[2]; data[idx+3]=color[3];

Â  Â  if(x>0) pixelStack.push([x-1,y]);

Â  Â  if(x<width-1) pixelStack.push([x+1,y]);

Â  Â  if(y>0) pixelStack.push([x,y-1]);

Â  Â  if(y<height-1) pixelStack.push([x,y+1]);

Â  }

Â  ctx.putImageData(imgData,0,0);

}



function hexToRgba(hex){let c=hex.replace('#','');return [parseInt(c.substr(0,2),16),parseInt(c.substr(2,2),16),parseInt(c.substr(4,2),16),255];}

function colorsMatch(a,b){return a[0]===b[0] && a[1]===b[1] && a[2]===b[2] && a[3]===b[3];}

</script>

</body>

</html>
